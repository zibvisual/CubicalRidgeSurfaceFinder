#pragma once

#include <array>
#include <unordered_map>

#include <utils/BBox.hpp>
#include <utils/Dims.hpp>
#include <surface/Surface.hpp>

namespace futil
{
    // Look Up Table copied from hxiso with modifications made to be more performant

/*
*        7-----6-----6         y+
*       /|          /|         | z+
*     11 |        10 |         |/
*     /  7        /  5         *-----> x+
*    3------2----2   |
*    |   |       |   |
*    |   4-----4-|---5
*    3  /        1  /
*    | 8         | 9
*    |/          |/
*    0-----0-----1
* */

    typedef struct
    {
        unsigned char tri_edges[15]; /* up to 5 triangles */
    } MCElement;

    /**
     * @brief Look Up Table to calculate Edge Index given McDim3l.
     *
     * We return (x,y,z,w) with index of an edge given by indexOfVoxel + x + y * dims[0] + z * dims[0] * dims[1] + w * dims[0] * dims[1] * dims[2].
     * We assume the index of an edge in x-direction to be the same as the voxel (+0,+0,+0,+0)
     * and the y-direction to come afterwards (+0,+0,+0,+1), then z-direction with (+0,+0,+0,+2)
     *
     * Basically the w-number tells you about the "direction" of the face
     *
     */
    static const std::array<unsigned char, 4> EdgeNumberToEdgeIndexLUT[12] = {
        { 0, 0, 0, 0 },
        { 1, 0, 0, 1 },
        { 0, 1, 0, 0 },
        { 0, 0, 0, 1 },
        { 0, 0, 1, 0 },
        { 1, 0, 1, 1 },
        { 0, 1, 1, 0 },
        { 0, 0, 1, 1 },
        { 0, 0, 0, 2 },
        { 1, 0, 0, 2 },
        { 1, 1, 0, 2 },
        { 0, 1, 0, 2 },
    };

    /**
     * @brief Look Up Table to calculate vertex offset
     *
     * We return (x,y,z) with index of a vertex given by indexOfVoxel + x + y * dims[0] + z * dims[1].
     *
     */
    static const std::array<unsigned char, 3> VerticesOffset[8] = {
        { 0, 0, 0 },
        { 1, 0, 0 },
        { 1, 1, 0 },
        { 0, 1, 0 },
        { 0, 0, 1 },
        { 1, 0, 1 },
        { 1, 1, 1 },
        { 0, 1, 1 },
    };

    static const std::array<float, 3> EdgeWorldCoords[12] = {
        { 0.5, 0.0, 0.0 },
        { 1.0, 0.5, 0.0 },
        { 0.5, 1.0, 0.0 },
        { 0.0, 0.5, 0.0 },
        { 0.5, 0.0, 1.0 },
        { 1.0, 0.5, 1.0 },
        { 0.5, 1.0, 1.0 },
        { 0.0, 0.5, 1.0 },
        { 0.0, 0.0, 0.5 },
        { 1.0, 0.0, 0.5 },
        { 1.0, 1.0, 0.5 },
        { 0.0, 1.0, 0.5 },
    };

    /** VertexEdgeNeighbor and VertexVertexNeighbor tables are syncronised:
     *  For a given vertex, the neighboring vertex and the edge between them are at the same index in both.
     *
     *
     * */
    static const std::array<unsigned char, 3> VertexEdgeNeighbor[8] = {
        { 0, 3, 8 },
        { 0, 1, 9 },
        { 1, 2, 10 },
        { 3, 2, 11 },
        { 8, 4, 7 },
        { 9, 4, 5 },
        { 10, 5, 6 },
        { 11, 7, 6 },
    };

    static const std::array<unsigned char, 3> VertexVertexNeighbor[8] = {
        { 1, 3, 4 },
        { 0, 2, 5 },
        { 1, 3, 6 },
        { 0, 2, 7 },
        { 0, 5, 7 },
        { 1, 4, 6 },
        { 2, 5, 7 },
        { 3, 4, 6 },
    };

    static const std::array<unsigned char, 2> EdgeVertexNeighbor[12] = {
        { 0, 1 },
        { 1, 2 },
        { 2, 3 },
        { 3, 0 },
        { 4, 5 },
        { 5, 6 },
        { 6, 7 },
        { 7, 4 },
        { 0, 4 },
        { 1, 5 },
        { 2, 6 },
        { 3, 7 },
    };

    // to which two faces the edge belongs to -> this has no useful information right now...
    static const std::array<unsigned char, 6> EdgeEdgeNeighbor[12] = {
        { 1, 2, 3, 4, 8, 9 },
        { 0, 2, 3, 5, 9, 10 },
        { 0, 1, 3, 6, 10, 11},
        { 0, 1, 2, 7, 8, 11},
        { 0, 8, 9, 5, 6, 7 },
        { 1, 9, 10, 4, 6, 7},
        { 2, 10, 11, 4, 5, 7 },
        { 3, 8, 11, 4, 5, 6 },
        { 0, 4, 9, 3, 7, 11 },
        { 0, 4, 8, 1, 5, 10 },
        { 1, 5, 9, 2, 6, 11 },
        { 2, 6, 10, 3, 7, 8 },
    };

     inline void calculateTrianglesForLUT() {
         for(int index = 0; index < 6561; ++index){
              unsigned char labels[8] = {0,0,0,0,0,0,0,0};
              int rest = index;
              for(int i = 0; i < 8; ++i){
                  labels[i] = rest % 3;
                  rest = rest / 3;
              }

              // go through all nodes
              bool seen[8] = {false, false, false, false, false, false, false, false};
                  unsigned char triangles[15] = { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 };
                  signed char triangles_pointer = -1;

                  for(int i = 0; i < 8; ++i){
                      if(seen[i] || labels[i] != 1){
                          continue;
                      }

                      bool set[8] = {false, false, false, false, false, false, false, false};
                      unsigned char stack[8] = {255, 255, 255, 255, 255, 255, 255, 255};
                      signed char stack_pointer = -1;
                      bool neighbor_edges[12] = {false, false, false, false, false, false, false, false, false, false, false, false};
                      unsigned char neighbor_edge = 255;

                      stack[++stack_pointer] = i;
                      // start searching
                      while(stack_pointer >= 0){
                          unsigned char elem = stack[stack_pointer--];
                          set[elem] = true;
                          // check if all neighbors are NOT 0
                          for(int j = 0; j < 3; ++j){
                              unsigned char neighbor = VertexVertexNeighbor[elem][j];
                              if(labels[neighbor] == 0){
                                  for(int k = 0; k < 8; ++k){
                                      set[k] = false;
                                  }
                                  for(int k = 0; k < 12; ++k){
                                      neighbor_edges[k] = false;
                                  }
                                  stack_pointer = -1;
                                  neighbor_edge = 255;
                                  break;
                              }else if(labels[neighbor] == 1 && !set[neighbor]){
                                  stack[++stack_pointer] = neighbor;
                              }else if(labels[neighbor] == 2){
                                  neighbor_edges[VertexEdgeNeighbor[elem][j]] = true;
                                  neighbor_edge = VertexEdgeNeighbor[elem][j];
                              }
                          }
                      }

                      // end of search -> find polygon and triangulate it for set (through neighbor)
                      if(neighbor_edge == 255){
                          continue;
                      }

                      //EdgeEdgeNeighbor tells us how they are connected -> cycle trhough them
                      unsigned char first = neighbor_edge;
                      unsigned char second = 255;
                      for(int j = 0; j < 6; ++j){
                          unsigned char candidate = EdgeEdgeNeighbor[neighbor_edge][j];
                          if(neighbor_edges[candidate]){
                              second = candidate;
                              break;
                          }
                      }

                      while(true){
                          for(int j = 0; j < 6; ++j){
                              unsigned char candidate = EdgeEdgeNeighbor[second][j];
                              if(neighbor_edges[candidate] && candidate != first){
                                  first = second;
                                  second = candidate;
                                  break;
                              }
                          }

                          if(second == neighbor_edge){
                              break;
                          }

                          // generate triangle with neighbor_edge, first, second!
                          triangles[++triangles_pointer] = neighbor_edge;
                          triangles[++triangles_pointer] = first;
                          triangles[++triangles_pointer] = second;
                          for(int j = 0; j < 8; ++j){
                              seen[j] = seen[j] || set[j];
                          }
                      }
                      // find another polygon if possible
                  }

                  // print triangles
                  std::cout << "/* " << (int)index << "   ";
                  for(int i = 7; i >= 0; --i){
                      std::cout << (int)labels[i];
                  }
                  std::cout << " */ {";
                  for(int i = 0; i < 14; ++i){
                      std::cout << (int)triangles[i] << ", ";
                  }
                  std::cout << (int)triangles[14];
                  std::cout << "}," << std::endl;
             }
     }

    /*
     * The implemented marching cubes uses
     * the following edge/node numbering.
     *
     * Also important to note is that the surface is given in the wrong direction
     * TODO: change to correct orientation
     *
     * PERF: We may want to delete verts array as this is already given by the index of the LUT. Also edge index might also be uneccesary
     *
     *
     *        7-----6-----6         y+
     *       /|          /|         | z+
     *     11 |        10 |         |/
     *     /  7        /  5         *-----> x+
     *    3------2----2   |
     *    |   |       |   |
     *    |   4-----4-|---5
     *    3  /        1  /
     *    | 8         | 9
     *    |/          |/
     *    0-----0-----1
     * */
    static const MCElement MCLUT[256] = {
        /*   0    00000000 */ {
            { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   1    00000001 */ {
            { 0, 3, 8, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   2    00000010 */ {
            { 0, 9, 1, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   3    00000011 */ {
            { 1, 8, 9, 1, 3, 8, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   4    00000100 */ {
            { 2, 1, 10, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   5    00000101 */ {
            { 0, 3, 8, 2, 1, 10, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   6    00000110 */ {
            { 9, 2, 0, 9, 10, 2, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   7    00000111 */ {
            { 10, 8, 9, 2, 8, 10, 2, 3, 8, 255, 255, 255, 255, 255, 255 },
        },
        /*   8    00001000 */ {
            { 2, 11, 3, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*   9    00001001 */ {
            { 11, 0, 2, 11, 8, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  10    00001010 */ {
            { 1, 0, 9, 3, 2, 11, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  11    00001011 */ {
            { 9, 11, 8, 1, 11, 9, 1, 2, 11, 255, 255, 255, 255, 255, 255 },
        },
        /*  12    00001100 */ {
            { 10, 3, 1, 10, 11, 3, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  13    00001101 */ {
            { 8, 10, 11, 0, 10, 8, 0, 1, 10, 255, 255, 255, 255, 255, 255 },
        },
        /*  14    00001110 */ {
            { 11, 9, 10, 3, 9, 11, 3, 0, 9, 255, 255, 255, 255, 255, 255 },
        },
        /*  15    00001111 */ {
            { 11, 8, 9, 11, 9, 10, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  16    00010000 */ {
            { 4, 8, 7, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  17    00010001 */ {
            { 3, 4, 0, 3, 7, 4, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  18    00010010 */ {
            { 4, 8, 7, 0, 9, 1, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  19    00010011 */ {
            { 7, 1, 3, 4, 1, 7, 4, 9, 1, 255, 255, 255, 255, 255, 255 },
        },
        /*  20    00010100 */ {
            { 4, 8, 7, 10, 2, 1, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  21    00010101 */ {
            { 1, 10, 2, 3, 7, 4, 3, 4, 0, 255, 255, 255, 255, 255, 255 },
        },
        /*  22    00010110 */ {
            { 8, 7, 4, 9, 10, 2, 9, 2, 0, 255, 255, 255, 255, 255, 255 },
        },
        /*  23    00010111 */ {
            { 2, 9, 10, 2, 7, 9, 2, 3, 7, 9, 7, 4, 255, 255, 255 },
        },
        /*  24    00011000 */ {
            { 8, 7, 4, 11, 3, 2, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  25    00011001 */ {
            { 2, 4, 0, 11, 4, 2, 11, 7, 4, 255, 255, 255, 255, 255, 255 },
        },
        /*  26    00011010 */ {
            { 9, 1, 0, 3, 2, 11, 8, 7, 4, 255, 255, 255, 255, 255, 255 },
        },
        /*  27    00011011 */ {
            { 9, 1, 2, 4, 9, 2, 11, 4, 2, 7, 4, 11, 255, 255, 255 },
        },
        /*  28    00011100 */ {
            { 7, 4, 8, 3, 1, 10, 3, 10, 11, 255, 255, 255, 255, 255, 255 },
        },
        /*  29    00011101 */ {
            { 10, 11, 1, 11, 4, 1, 4, 0, 1, 7, 4, 11, 255, 255, 255 },
        },
        /*  30    00011110 */ {
            { 11, 9, 10, 11, 0, 9, 3, 0, 11, 7, 4, 8, 255, 255, 255 },
        },
        /*  31    00011111 */ {
            { 11, 9, 10, 11, 4, 9, 7, 4, 11, 255, 255, 255, 255, 255, 255 },
        },
        /*  32    00100000 */ {
            { 4, 5, 9, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  33    00100001 */ {
            { 9, 4, 5, 8, 0, 3, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  34    00100010 */ {
            { 5, 0, 4, 5, 1, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  35    00100011 */ {
            { 3, 5, 1, 8, 5, 3, 8, 4, 5, 255, 255, 255, 255, 255, 255 },
        },
        /*  36    00100100 */ {
            { 1, 10, 2, 5, 9, 4, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  37    00100101 */ {
            { 10, 2, 1, 0, 3, 8, 9, 4, 5, 255, 255, 255, 255, 255, 255 },
        },
        /*  38    00100110 */ {
            { 4, 2, 0, 5, 2, 4, 5, 10, 2, 255, 255, 255, 255, 255, 255 },
        },
        /*  39    00100111 */ {
            { 10, 2, 3, 5, 10, 3, 8, 5, 3, 4, 5, 8, 255, 255, 255 },
        },
        /*  40    00101000 */ {
            { 2, 11, 3, 9, 4, 5, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  41    00101001 */ {
            { 4, 5, 9, 0, 2, 11, 0, 11, 8, 255, 255, 255, 255, 255, 255 },
        },
        /*  42    00101010 */ {
            { 2, 11, 3, 0, 4, 5, 0, 5, 1, 255, 255, 255, 255, 255, 255 },
        },
        /*  43    00101011 */ {
            { 11, 8, 2, 8, 5, 2, 5, 1, 2, 4, 5, 8, 255, 255, 255 },
        },
        /*  44    00101100 */ {
            { 9, 4, 5, 10, 11, 3, 10, 3, 1, 255, 255, 255, 255, 255, 255 },
        },
        /*  45    00101101 */ {
            { 8, 10, 11, 8, 1, 10, 0, 1, 8, 4, 5, 9, 255, 255, 255 },
        },
        /*  46    00101110 */ {
            { 3, 10, 11, 3, 4, 10, 3, 0, 4, 10, 4, 5, 255, 255, 255 },
        },
        /*  47    00101111 */ {
            { 8, 10, 11, 8, 5, 10, 4, 5, 8, 255, 255, 255, 255, 255, 255 },
        },
        /*  48    00110000 */ {
            { 9, 7, 5, 9, 8, 7, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  49    00110001 */ {
            { 5, 3, 7, 9, 3, 5, 9, 0, 3, 255, 255, 255, 255, 255, 255 },
        },
        /*  50    00110010 */ {
            { 1, 7, 5, 0, 7, 1, 0, 8, 7, 255, 255, 255, 255, 255, 255 },
        },
        /*  51    00110011 */ {
            { 3, 7, 5, 3, 5, 1, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  52    00110100 */ {
            { 10, 2, 1, 9, 8, 7, 9, 7, 5, 255, 255, 255, 255, 255, 255 },
        },
        /*  53    00110101 */ {
            { 5, 3, 7, 5, 0, 3, 9, 0, 5, 10, 2, 1, 255, 255, 255 },
        },
        /*  54    00110110 */ {
            { 7, 5, 8, 5, 2, 8, 2, 0, 8, 10, 2, 5, 255, 255, 255 },
        },
        /*  55    00110111 */ {
            { 5, 3, 7, 5, 2, 3, 10, 2, 5, 255, 255, 255, 255, 255, 255 },
        },
        /*  56    00111000 */ {
            { 3, 2, 11, 7, 5, 9, 7, 9, 8, 255, 255, 255, 255, 255, 255 },
        },
        /*  57    00111001 */ {
            { 9, 7, 5, 9, 2, 7, 9, 0, 2, 7, 2, 11, 255, 255, 255 },
        },
        /*  58    00111010 */ {
            { 1, 7, 5, 1, 8, 7, 0, 8, 1, 2, 11, 3, 255, 255, 255 },
        },
        /*  59    00111011 */ {
            { 1, 7, 5, 1, 11, 7, 2, 11, 1, 255, 255, 255, 255, 255, 255 },
        },
        /*  60    00111100 */ {
            { 10, 11, 1, 11, 3, 1, 9, 7, 5, 9, 8, 7, 255, 255, 255 },
        },
        /*  61    00111101 */ {
            { 5, 9, 7, 7, 9, 0, 7, 0, 11, 0, 1, 11, 1, 10, 11 },
        },
        /*  62    00111110 */ {
            { 5, 8, 7, 8, 5, 0, 0, 5, 10, 0, 10, 3, 3, 10, 11 },
        },
        /*  63    00111111 */ {
            { 11, 5, 10, 7, 5, 11, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  64    01000000 */ {
            { 6, 10, 5, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  65    01000001 */ {
            { 0, 3, 8, 5, 6, 10, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  66    01000010 */ {
            { 9, 1, 0, 10, 5, 6, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  67    01000011 */ {
            { 5, 6, 10, 1, 3, 8, 1, 8, 9, 255, 255, 255, 255, 255, 255 },
        },
        /*  68    01000100 */ {
            { 1, 6, 2, 1, 5, 6, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  69    01000101 */ {
            { 3, 8, 0, 1, 5, 6, 1, 6, 2, 255, 255, 255, 255, 255, 255 },
        },
        /*  70    01000110 */ {
            { 0, 6, 2, 9, 6, 0, 9, 5, 6, 255, 255, 255, 255, 255, 255 },
        },
        /*  71    01000111 */ {
            { 8, 9, 3, 9, 6, 3, 6, 2, 3, 5, 6, 9, 255, 255, 255 },
        },
        /*  72    01001000 */ {
            { 2, 11, 3, 6, 10, 5, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  73    01001001 */ {
            { 10, 5, 6, 11, 8, 0, 11, 0, 2, 255, 255, 255, 255, 255, 255 },
        },
        /*  74    01001010 */ {
            { 5, 6, 10, 2, 11, 3, 1, 0, 9, 255, 255, 255, 255, 255, 255 },
        },
        /*  75    01001011 */ {
            { 9, 11, 8, 9, 2, 11, 1, 2, 9, 5, 6, 10, 255, 255, 255 },
        },
        /*  76    01001100 */ {
            { 5, 3, 1, 6, 3, 5, 6, 11, 3, 255, 255, 255, 255, 255, 255 },
        },
        /*  77    01001101 */ {
            { 6, 1, 5, 6, 8, 1, 6, 11, 8, 1, 8, 0, 255, 255, 255 },
        },
        /*  78    01001110 */ {
            { 5, 6, 11, 9, 5, 11, 3, 9, 11, 0, 9, 3, 255, 255, 255 },
        },
        /*  79    01001111 */ {
            { 9, 11, 8, 9, 6, 11, 5, 6, 9, 255, 255, 255, 255, 255, 255 },
        },
        /*  80    01010000 */ {
            { 5, 6, 10, 7, 4, 8, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  81    01010001 */ {
            { 6, 10, 5, 4, 0, 3, 4, 3, 7, 255, 255, 255, 255, 255, 255 },
        },
        /*  82    01010010 */ {
            { 1, 0, 9, 4, 8, 7, 5, 6, 10, 255, 255, 255, 255, 255, 255 },
        },
        /*  83    01010011 */ {
            { 7, 1, 3, 7, 9, 1, 4, 9, 7, 6, 10, 5, 255, 255, 255 },
        },
        /*  84    01010100 */ {
            { 4, 8, 7, 6, 2, 1, 6, 1, 5, 255, 255, 255, 255, 255, 255 },
        },
        /*  85    01010101 */ {
            { 4, 0, 7, 0, 3, 7, 6, 1, 5, 6, 2, 1, 255, 255, 255 },
        },
        /*  86    01010110 */ {
            { 0, 6, 2, 0, 5, 6, 9, 5, 0, 8, 7, 4, 255, 255, 255 },
        },
        /*  87    01010111 */ {
            { 5, 6, 2, 5, 2, 9, 9, 2, 3, 9, 3, 4, 4, 3, 7 },
        },
        /*  88    01011000 */ {
            { 10, 5, 6, 7, 4, 8, 11, 3, 2, 255, 255, 255, 255, 255, 255 },
        },
        /*  89    01011001 */ {
            { 2, 4, 0, 2, 7, 4, 11, 7, 2, 10, 5, 6, 255, 255, 255 },
        },
        /*  90    01011010 */ {
            { 2, 11, 3, 10, 5, 6, 0, 9, 1, 4, 8, 7, 255, 255, 255 },
        },
        /*  91    01011011 */ {
            { 5, 6, 10, 4, 9, 1, 4, 1, 2, 4, 2, 7, 7, 2, 11 },
        },
        /*  92    01011100 */ {
            { 5, 3, 1, 5, 11, 3, 6, 11, 5, 4, 8, 7, 255, 255, 255 },
        },
        /*  93    01011101 */ {
            { 1, 5, 6, 1, 6, 11, 1, 11, 0, 7, 0, 11, 0, 7, 4 },
        },
        /*  94    01011110 */ {
            { 8, 7, 4, 0, 9, 5, 0, 5, 3, 3, 5, 6, 3, 6, 11 },
        },
        /*  95    01011111 */ {
            { 4, 9, 7, 9, 11, 7, 9, 5, 11, 5, 6, 11, 255, 255, 255 },
        },
        /*  96    01100000 */ {
            { 10, 4, 6, 10, 9, 4, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /*  97    01100001 */ {
            { 0, 3, 8, 4, 6, 10, 4, 10, 9, 255, 255, 255, 255, 255, 255 },
        },
        /*  98    01100010 */ {
            { 6, 0, 4, 10, 0, 6, 10, 1, 0, 255, 255, 255, 255, 255, 255 },
        },
        /*  99    01100011 */ {
            { 8, 1, 3, 8, 6, 1, 8, 4, 6, 1, 6, 10, 255, 255, 255 },
        },
        /* 100    01100100 */ {
            { 2, 4, 6, 1, 4, 2, 1, 9, 4, 255, 255, 255, 255, 255, 255 },
        },
        /* 101    01100101 */ {
            { 2, 4, 6, 2, 9, 4, 1, 9, 2, 3, 8, 0, 255, 255, 255 },
        },
        /* 102    01100110 */ {
            { 0, 4, 6, 0, 6, 2, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 103    01100111 */ {
            { 2, 4, 6, 2, 8, 4, 3, 8, 2, 255, 255, 255, 255, 255, 255 },
        },
        /* 104    01101000 */ {
            { 11, 3, 2, 10, 9, 4, 10, 4, 6, 255, 255, 255, 255, 255, 255 },
        },
        /* 105    01101001 */ {
            { 0, 2, 8, 2, 11, 8, 4, 10, 9, 4, 6, 10, 255, 255, 255 },
        },
        /* 106    01101010 */ {
            { 6, 0, 4, 6, 1, 0, 10, 1, 6, 11, 3, 2, 255, 255, 255 },
        },
        /* 107    01101011 */ {
            { 8, 2, 11, 8, 1, 2, 8, 4, 1, 1, 4, 10, 4, 6, 10 },
        },
        /* 108    01101100 */ {
            { 3, 1, 11, 1, 4, 11, 4, 6, 11, 9, 4, 1, 255, 255, 255 },
        },
        /* 109    01101101 */ {
            { 8, 0, 11, 0, 1, 11, 1, 6, 11, 1, 9, 6, 4, 6, 9 },
        },
        /* 110    01101110 */ {
            { 6, 0, 4, 6, 3, 0, 11, 3, 6, 255, 255, 255, 255, 255, 255 },
        },
        /* 111    01101111 */ {
            { 6, 8, 4, 11, 8, 6, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 112    01110000 */ {
            { 8, 10, 9, 7, 10, 8, 7, 6, 10, 255, 255, 255, 255, 255, 255 },
        },
        /* 113    01110001 */ {
            { 3, 7, 0, 7, 10, 0, 10, 9, 0, 6, 10, 7, 255, 255, 255 },
        },
        /* 114    01110010 */ {
            { 1, 0, 8, 10, 1, 8, 7, 10, 8, 6, 10, 7, 255, 255, 255 },
        },
        /* 115    01110011 */ {
            { 7, 1, 3, 7, 10, 1, 6, 10, 7, 255, 255, 255, 255, 255, 255 },
        },
        /* 116    01110100 */ {
            { 7, 9, 8, 7, 2, 9, 7, 6, 2, 9, 2, 1, 255, 255, 255 },
        },
        /* 117    01110101 */ {
            { 0, 3, 7, 0, 7, 9, 9, 7, 6, 1, 9, 6, 1, 6, 2 },
        },
        /* 118    01110110 */ {
            { 0, 6, 2, 0, 7, 6, 8, 7, 0, 255, 255, 255, 255, 255, 255 },
        },
        /* 119    01110111 */ {
            { 2, 7, 6, 3, 7, 2, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 120    01111000 */ {
            { 8, 10, 9, 8, 6, 10, 7, 6, 8, 3, 2, 11, 255, 255, 255 },
        },
        /* 121    01111001 */ {
            { 0, 2, 11, 11, 7, 0, 0, 7, 9, 9, 7, 6, 9, 6, 10 },
        },
        /* 122    01111010 */ {
            { 3, 2, 11, 0, 8, 1, 1, 8, 7, 1, 7, 10, 7, 6, 10 },
        },
        /* 123    01111011 */ {
            { 1, 6, 10, 1, 7, 6, 1, 2, 7, 7, 2, 11, 255, 255, 255 },
        },
        /* 124    01111100 */ {
            { 3, 1, 11, 1, 6, 11, 1, 9, 6, 6, 9, 7, 7, 9, 8 },
        },
        /* 125    01111101 */ {
            { 7, 6, 11, 0, 1, 9, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 126    01111110 */ {
            { 0, 6, 11, 3, 0, 11, 0, 8, 6, 6, 8, 7, 255, 255, 255 },
        },
        /* 127    01111111 */ {
            { 7, 6, 11, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 128    10000000 */ {
            { 6, 7, 11, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 129    10000001 */ {
            { 3, 8, 0, 7, 11, 6, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 130    10000010 */ {
            { 6, 7, 11, 1, 0, 9, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 131    10000011 */ {
            { 11, 6, 7, 8, 9, 1, 8, 1, 3, 255, 255, 255, 255, 255, 255 },
        },
        /* 132    10000100 */ {
            { 10, 2, 1, 11, 6, 7, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 133    10000101 */ {
            { 1, 10, 2, 11, 6, 7, 3, 8, 0, 255, 255, 255, 255, 255, 255 },
        },
        /* 134    10000110 */ {
            { 6, 7, 11, 2, 0, 9, 2, 9, 10, 255, 255, 255, 255, 255, 255 },
        },
        /* 135    10000111 */ {
            { 10, 8, 9, 10, 3, 8, 2, 3, 10, 6, 7, 11, 255, 255, 255 },
        },
        /* 136    10001000 */ {
            { 7, 2, 6, 7, 3, 2, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 137    10001001 */ {
            { 6, 0, 2, 7, 0, 6, 7, 8, 0, 255, 255, 255, 255, 255, 255 },
        },
        /* 138    10001010 */ {
            { 0, 9, 1, 2, 6, 7, 2, 7, 3, 255, 255, 255, 255, 255, 255 },
        },
        /* 139    10001011 */ {
            { 1, 8, 9, 1, 6, 8, 1, 2, 6, 8, 6, 7, 255, 255, 255 },
        },
        /* 140    10001100 */ {
            { 1, 7, 3, 10, 7, 1, 10, 6, 7, 255, 255, 255, 255, 255, 255 },
        },
        /* 141    10001101 */ {
            { 1, 10, 6, 0, 1, 6, 7, 0, 6, 8, 0, 7, 255, 255, 255 },
        },
        /* 142    10001110 */ {
            { 7, 3, 6, 3, 9, 6, 9, 10, 6, 0, 9, 3, 255, 255, 255 },
        },
        /* 143    10001111 */ {
            { 10, 8, 9, 10, 7, 8, 6, 7, 10, 255, 255, 255, 255, 255, 255 },
        },
        /* 144    10010000 */ {
            { 8, 6, 4, 8, 11, 6, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 145    10010001 */ {
            { 0, 6, 4, 3, 6, 0, 3, 11, 6, 255, 255, 255, 255, 255, 255 },
        },
        /* 146    10010010 */ {
            { 9, 1, 0, 8, 11, 6, 8, 6, 4, 255, 255, 255, 255, 255, 255 },
        },
        /* 147    10010011 */ {
            { 1, 3, 9, 3, 6, 9, 6, 4, 9, 11, 6, 3, 255, 255, 255 },
        },
        /* 148    10010100 */ {
            { 2, 1, 10, 6, 4, 8, 6, 8, 11, 255, 255, 255, 255, 255, 255 },
        },
        /* 149    10010101 */ {
            { 0, 6, 4, 0, 11, 6, 3, 11, 0, 1, 10, 2, 255, 255, 255 },
        },
        /* 150    10010110 */ {
            { 6, 4, 11, 4, 8, 11, 2, 9, 10, 2, 0, 9, 255, 255, 255 },
        },
        /* 151    10010111 */ {
            { 9, 10, 2, 9, 2, 3, 9, 3, 4, 4, 3, 11, 6, 4, 11 },
        },
        /* 152    10011000 */ {
            { 4, 2, 6, 8, 2, 4, 8, 3, 2, 255, 255, 255, 255, 255, 255 },
        },
        /* 153    10011001 */ {
            { 4, 0, 2, 4, 2, 6, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 154    10011010 */ {
            { 4, 2, 6, 4, 3, 2, 8, 3, 4, 9, 1, 0, 255, 255, 255 },
        },
        /* 155    10011011 */ {
            { 4, 2, 6, 4, 1, 2, 9, 1, 4, 255, 255, 255, 255, 255, 255 },
        },
        /* 156    10011100 */ {
            { 10, 3, 1, 10, 4, 3, 10, 6, 4, 3, 4, 8, 255, 255, 255 },
        },
        /* 157    10011101 */ {
            { 0, 6, 4, 0, 10, 6, 1, 10, 0, 255, 255, 255, 255, 255, 255 },
        },
        /* 158    10011110 */ {
            { 0, 9, 10, 0, 10, 3, 3, 10, 6, 3, 6, 8, 8, 6, 4 },
        },
        /* 159    10011111 */ {
            { 4, 10, 6, 9, 10, 4, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 160    10100000 */ {
            { 6, 7, 11, 4, 5, 9, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 161    10100001 */ {
            { 5, 9, 4, 8, 0, 3, 7, 11, 6, 255, 255, 255, 255, 255, 255 },
        },
        /* 162    10100010 */ {
            { 7, 11, 6, 5, 1, 0, 5, 0, 4, 255, 255, 255, 255, 255, 255 },
        },
        /* 163    10100011 */ {
            { 3, 5, 1, 3, 4, 5, 8, 4, 3, 11, 6, 7, 255, 255, 255 },
        },
        /* 164    10100100 */ {
            { 9, 4, 5, 6, 7, 11, 10, 2, 1, 255, 255, 255, 255, 255, 255 },
        },
        /* 165    10100101 */ {
            { 0, 3, 8, 1, 10, 2, 4, 5, 9, 6, 7, 11, 255, 255, 255 },
        },
        /* 166    10100110 */ {
            { 4, 2, 0, 4, 10, 2, 5, 10, 4, 7, 11, 6, 255, 255, 255 },
        },
        /* 167    10100111 */ {
            { 4, 5, 8, 5, 3, 8, 3, 5, 10, 3, 10, 2, 6, 7, 11 },
        },
        /* 168    10101000 */ {
            { 5, 9, 4, 7, 3, 2, 7, 2, 6, 255, 255, 255, 255, 255, 255 },
        },
        /* 169    10101001 */ {
            { 6, 0, 2, 6, 8, 0, 7, 8, 6, 5, 9, 4, 255, 255, 255 },
        },
        /* 170    10101010 */ {
            { 2, 6, 3, 6, 7, 3, 0, 5, 1, 0, 4, 5, 255, 255, 255 },
        },
        /* 171    10101011 */ {
            { 4, 5, 1, 8, 4, 1, 8, 1, 2, 8, 2, 7, 7, 2, 6 },
        },
        /* 172    10101100 */ {
            { 1, 7, 3, 1, 6, 7, 10, 6, 1, 9, 4, 5, 255, 255, 255 },
        },
        /* 173    10101101 */ {
            { 4, 5, 9, 0, 1, 8, 8, 1, 7, 7, 1, 10, 7, 10, 6 },
        },
        /* 174    10101110 */ {
            { 0, 4, 5, 0, 5, 10, 0, 10, 3, 3, 10, 6, 3, 6, 7 },
        },
        /* 175    10101111 */ {
            { 4, 5, 10, 4, 10, 8, 8, 10, 6, 8, 6, 7, 255, 255, 255 },
        },
        /* 176    10110000 */ {
            { 11, 9, 8, 6, 9, 11, 6, 5, 9, 255, 255, 255, 255, 255, 255 },
        },
        /* 177    10110001 */ {
            { 5, 9, 0, 6, 5, 0, 3, 6, 0, 11, 6, 3, 255, 255, 255 },
        },
        /* 178    10110010 */ {
            { 0, 5, 1, 0, 11, 5, 0, 8, 11, 5, 11, 6, 255, 255, 255 },
        },
        /* 179    10110011 */ {
            { 3, 5, 1, 3, 6, 5, 11, 6, 3, 255, 255, 255, 255, 255, 255 },
        },
        /* 180    10110100 */ {
            { 11, 9, 8, 11, 5, 9, 6, 5, 11, 2, 1, 10, 255, 255, 255 },
        },
        /* 181    10110101 */ {
            { 0, 5, 9, 0, 3, 5, 5, 3, 6, 6, 3, 11, 1, 10, 2 },
        },
        /* 182    10110110 */ {
            { 2, 0, 10, 0, 5, 10, 0, 8, 5, 5, 8, 6, 6, 8, 11 },
        },
        /* 183    10110111 */ {
            { 2, 3, 10, 3, 5, 10, 5, 3, 11, 6, 5, 11, 255, 255, 255 },
        },
        /* 184    10111000 */ {
            { 9, 8, 5, 8, 2, 5, 2, 6, 5, 3, 2, 8, 255, 255, 255 },
        },
        /* 185    10111001 */ {
            { 6, 0, 2, 6, 9, 0, 5, 9, 6, 255, 255, 255, 255, 255, 255 },
        },
        /* 186    10111010 */ {
            { 5, 1, 0, 8, 5, 0, 5, 8, 6, 3, 6, 8, 6, 3, 2 },
        },
        /* 187    10111011 */ {
            { 6, 1, 2, 5, 1, 6, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 188    10111100 */ {
            { 3, 1, 10, 6, 3, 10, 3, 6, 8, 5, 8, 6, 5, 9, 8 },
        },
        /* 189    10111101 */ {
            { 9, 6, 5, 9, 0, 6, 6, 0, 10, 0, 1, 10, 255, 255, 255 },
        },
        /* 190    10111110 */ {
            { 3, 0, 8, 6, 5, 10, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 191    10111111 */ {
            { 10, 6, 5, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 192    11000000 */ {
            { 5, 11, 10, 5, 7, 11, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 193    11000001 */ {
            { 8, 0, 3, 11, 10, 5, 11, 5, 7, 255, 255, 255, 255, 255, 255 },
        },
        /* 194    11000010 */ {
            { 1, 0, 9, 5, 7, 11, 5, 11, 10, 255, 255, 255, 255, 255, 255 },
        },
        /* 195    11000011 */ {
            { 1, 3, 9, 3, 8, 9, 5, 11, 10, 5, 7, 11, 255, 255, 255 },
        },
        /* 196    11000100 */ {
            { 7, 1, 5, 11, 1, 7, 11, 2, 1, 255, 255, 255, 255, 255, 255 },
        },
        /* 197    11000101 */ {
            { 7, 1, 5, 7, 2, 1, 11, 2, 7, 8, 0, 3, 255, 255, 255 },
        },
        /* 198    11000110 */ {
            { 11, 5, 7, 11, 0, 5, 11, 2, 0, 5, 0, 9, 255, 255, 255 },
        },
        /* 199    11000111 */ {
            { 9, 3, 8, 9, 2, 3, 9, 5, 2, 2, 5, 11, 5, 7, 11 },
        },
        /* 200    11001000 */ {
            { 3, 5, 7, 2, 5, 3, 2, 10, 5, 255, 255, 255, 255, 255, 255 },
        },
        /* 201    11001001 */ {
            { 5, 7, 10, 7, 0, 10, 0, 2, 10, 8, 0, 7, 255, 255, 255 },
        },
        /* 202    11001010 */ {
            { 3, 5, 7, 3, 10, 5, 2, 10, 3, 0, 9, 1, 255, 255, 255 },
        },
        /* 203    11001011 */ {
            { 8, 9, 1, 8, 1, 2, 8, 2, 7, 7, 2, 10, 5, 7, 10 },
        },
        /* 204    11001100 */ {
            { 7, 3, 1, 7, 1, 5, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 205    11001101 */ {
            { 7, 1, 5, 7, 0, 1, 8, 0, 7, 255, 255, 255, 255, 255, 255 },
        },
        /* 206    11001110 */ {
            { 3, 5, 7, 3, 9, 5, 0, 9, 3, 255, 255, 255, 255, 255, 255 },
        },
        /* 207    11001111 */ {
            { 7, 9, 5, 8, 9, 7, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 208    11010000 */ {
            { 10, 8, 11, 5, 8, 10, 5, 4, 8, 255, 255, 255, 255, 255, 255 },
        },
        /* 209    11010001 */ {
            { 5, 11, 10, 5, 0, 11, 5, 4, 0, 11, 0, 3, 255, 255, 255 },
        },
        /* 210    11010010 */ {
            { 10, 8, 11, 10, 4, 8, 5, 4, 10, 1, 0, 9, 255, 255, 255 },
        },
        /* 211    11010011 */ {
            { 1, 3, 9, 3, 4, 9, 3, 11, 4, 11, 5, 4, 11, 10, 5 },
        },
        /* 212    11010100 */ {
            { 8, 11, 4, 11, 1, 4, 1, 5, 4, 2, 1, 11, 255, 255, 255 },
        },
        /* 213    11010101 */ {
            { 4, 0, 3, 3, 11, 4, 5, 4, 11, 2, 5, 11, 5, 2, 1 },
        },
        /* 214    11010110 */ {
            { 2, 0, 9, 2, 9, 5, 2, 5, 11, 11, 5, 4, 11, 4, 8 },
        },
        /* 215    11010111 */ {
            { 11, 2, 3, 4, 9, 5, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 216    11011000 */ {
            { 10, 5, 4, 2, 10, 4, 8, 2, 4, 3, 2, 8, 255, 255, 255 },
        },
        /* 217    11011001 */ {
            { 2, 4, 0, 2, 5, 4, 10, 5, 2, 255, 255, 255, 255, 255, 255 },
        },
        /* 218    11011010 */ {
            { 0, 9, 1, 8, 5, 4, 5, 8, 10, 3, 10, 8, 2, 10, 3 },
        },
        /* 219    11011011 */ {
            { 9, 1, 4, 4, 1, 2, 4, 2, 5, 2, 10, 5, 255, 255, 255 },
        },
        /* 220    11011100 */ {
            { 5, 3, 1, 5, 8, 3, 4, 8, 5, 255, 255, 255, 255, 255, 255 },
        },
        /* 221    11011101 */ {
            { 0, 5, 4, 1, 5, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 222    11011110 */ {
            { 0, 9, 3, 3, 9, 5, 8, 3, 5, 8, 5, 4, 255, 255, 255 },
        },
        /* 223    11011111 */ {
            { 5, 4, 9, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 224    11100000 */ {
            { 9, 11, 10, 4, 11, 9, 4, 7, 11, 255, 255, 255, 255, 255, 255 },
        },
        /* 225    11100001 */ {
            { 9, 11, 10, 9, 7, 11, 4, 7, 9, 0, 3, 8, 255, 255, 255 },
        },
        /* 226    11100010 */ {
            { 11, 10, 7, 10, 0, 7, 0, 4, 7, 1, 0, 10, 255, 255, 255 },
        },
        /* 227    11100011 */ {
            { 1, 3, 8, 1, 8, 4, 1, 4, 10, 10, 4, 7, 11, 10, 7 },
        },
        /* 228    11100100 */ {
            { 9, 4, 7, 1, 9, 7, 11, 1, 7, 2, 1, 11, 255, 255, 255 },
        },
        /* 229    11100101 */ {
            { 0, 3, 8, 1, 9, 4, 1, 4, 7, 1, 7, 2, 2, 7, 11 },
        },
        /* 230    11100110 */ {
            { 4, 2, 0, 4, 11, 2, 7, 11, 4, 255, 255, 255, 255, 255, 255 },
        },
        /* 231    11100111 */ {
            { 8, 4, 3, 3, 4, 2, 7, 2, 4, 2, 7, 11, 255, 255, 255 },
        },
        /* 232    11101000 */ {
            { 4, 10, 9, 4, 3, 10, 4, 7, 3, 10, 3, 2, 255, 255, 255 },
        },
        /* 233    11101001 */ {
            { 2, 8, 0, 2, 7, 8, 2, 10, 7, 10, 4, 7, 10, 9, 4 },
        },
        /* 234    11101010 */ {
            { 7, 3, 2, 2, 10, 7, 4, 7, 10, 1, 4, 10, 4, 1, 0 },
        },
        /* 235    11101011 */ {
            { 8, 4, 7, 2, 10, 1, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 236    11101100 */ {
            { 1, 7, 3, 1, 4, 7, 9, 4, 1, 255, 255, 255, 255, 255, 255 },
        },
        /* 237    11101101 */ {
            { 0, 7, 8, 0, 1, 7, 1, 4, 7, 4, 1, 9, 255, 255, 255 },
        },
        /* 238    11101110 */ {
            { 4, 3, 0, 7, 3, 4, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 239    11101111 */ {
            { 8, 4, 7, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 240    11110000 */ {
            { 8, 11, 10, 8, 10, 9, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 241    11110001 */ {
            { 9, 11, 10, 9, 3, 11, 0, 3, 9, 255, 255, 255, 255, 255, 255 },
        },
        /* 242    11110010 */ {
            { 10, 8, 11, 10, 0, 8, 1, 0, 10, 255, 255, 255, 255, 255, 255 },
        },
        /* 243    11110011 */ {
            { 3, 10, 1, 11, 10, 3, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 244    11110100 */ {
            { 11, 9, 8, 11, 1, 9, 2, 1, 11, 255, 255, 255, 255, 255, 255 },
        },
        /* 245    11110101 */ {
            { 0, 3, 11, 0, 11, 9, 2, 9, 11, 9, 2, 1, 255, 255, 255 },
        },
        /* 246    11110110 */ {
            { 0, 11, 2, 8, 11, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 247    11110111 */ {
            { 11, 2, 3, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 248    11111000 */ {
            { 8, 10, 9, 8, 2, 10, 3, 2, 8, 255, 255, 255, 255, 255, 255 },
        },
        /* 249    11111001 */ {
            { 2, 9, 0, 10, 9, 2, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 250    11111010 */ {
            { 1, 0, 10, 0, 8, 10, 2, 10, 8, 2, 8, 3, 255, 255, 255 },
        },
        /* 251    11111011 */ {
            { 1, 2, 10, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 252    11111100 */ {
            { 8, 1, 9, 3, 1, 8, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 253    11111101 */ {
            { 9, 0, 1, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 254    11111110 */ {
            { 3, 0, 8, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
        /* 255    11111111 */ {
            { 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
        },
    };

    // PERF: faster if we use offset instead of dims
    inline int64_t getGlobalEdgeIndex(unsigned char edge, VecSize voxel, Dims dims)
    {
        auto edgeWeights = EdgeNumberToEdgeIndexLUT[edge];
        auto edgeIndex = (voxel[0] + edgeWeights[0])
                         + (voxel[1] + edgeWeights[1]) * dims[0]
                         + (voxel[2] + edgeWeights[2]) * dims[0] * dims[1]
                         + edgeWeights[3] * dims[0] * dims[1] * dims[2];
        return edgeIndex;
    }

    inline int64_t getGlobalEdgeIndex(unsigned char edge, VecSize voxel, std::array<int64_t, 3> offset)
    {
        auto edgeWeights = EdgeNumberToEdgeIndexLUT[edge];
        auto edgeIndex = (voxel[0] + edgeWeights[0])
                         + (voxel[1] + edgeWeights[1]) * offset[0]
                         + (voxel[2] + edgeWeights[2]) * offset[1]
                         + edgeWeights[3] * offset[2];
        return edgeIndex;
    }

    inline int64_t getGlobalEdgeIndex(unsigned char edge, int64_t voxelId, std::array<int64_t, 3> offset)
    {
        auto edgeWeights = EdgeNumberToEdgeIndexLUT[edge];
        auto edgeIndex = voxelId + edgeWeights[0]
                         + edgeWeights[1] * offset[0]
                         + edgeWeights[2] * offset[1]
                         + edgeWeights[3] * offset[2];
        return edgeIndex;
    }

    inline int64_t getGlobalEdgeIndex(VecFloat point, std::array<int64_t, 3> offset, VecFloat voxelSize, VecFloat origin)
    {
        // reverse getEdgePosition!
        // TODO: we could make these calculations more compact
        // VecFloat pos = (point - origin) / voxelSize;
        float x = (point[0] - origin[0]) / voxelSize[0];
        float y = (point[1] - origin[1]) / voxelSize[1];
        float z = (point[2] - origin[2]) / voxelSize[2];

        // one of these has ?.5 the other ones are int!
        int ix = static_cast<int>(round(x));
        int iy = static_cast<int>(round(y));
        int iz = static_cast<int>(round(z));
        float dx = std::abs(x - ix);
        float dy = std::abs(y - iy);
        float dz = std::abs(z - iz);
        int maxArg;
        if (dx > dy && dx > dz)
        {
            maxArg = 0;
            ix = static_cast<int>(round(x - 0.5));
        }
        else if (dy > dx && dy > dz)
        {
            maxArg = 1;
            iy = static_cast<int>(round(y - 0.5));
        }
        else
        {
            maxArg = 2;
            iz = static_cast<int>(round(z - 0.5));
        }

        return ix + iy * offset[0] + iz * offset[1] + maxArg * offset[2];
    }

    inline int64_t getGlobalVoxelIndex(unsigned char voxel, int64_t voxelId, std::array<int64_t, 3> offset)
    {
        auto voxelWeights = VerticesOffset[voxel];
        auto voxelIndex = voxelId + voxelWeights[0]
                          + voxelWeights[1] * offset[0]
                          + voxelWeights[2] * offset[1];
        return voxelIndex;
    }

    inline VecFloat getEdgePosition(int64_t edgeId, std::array<int64_t, 3> offset, VecFloat voxelSize, VecFloat origin)
    {
        const int w = edgeId / offset[2];
        const uint64_t rest1 = edgeId - w * offset[2];
        const int z = rest1 / offset[1];
        const uint64_t rest2 = rest1 - z * offset[1];
        const int y = rest2 / offset[0];
        const int x = rest2 - y * offset[0];

        // wrong for dims[i] = 0, see HxLattice3 for a solution
        return VecFloat(
            (static_cast<float>(x) + (w == 0) * 0.5) * voxelSize[0] + origin[0],
            (static_cast<float>(y) + (w == 1) * 0.5) * voxelSize[1] + origin[1],
            (static_cast<float>(z) + (w == 2) * 0.5) * voxelSize[2] + origin[2]);
    }

    // class HashSurface
    // {
    // public:
    //     HashSurface()
    //         : m_offset({ 0, 0, 0 })
    //         , m_lattice(Lattice(Dims(0,0,0)))
    //     {}

    //     HashSurface(Lattice lattice)
    //         : m_offset({ lattice.dims()[0], lattice.dims()[0] * lattice.dims()[1], lattice.dims()[0] * lattice.dims()[1] * lattice.dims()[2] })
    //         , m_lattice(lattice)
    //     {
    //     }

    //     void clear()
    //     {
    //         m_map.clear();
    //         m_edgeIndexMapping.clear();
    //         m_edgeDistanceMapping.clear();
    //     }

    //     // void setDims(McDim3l dims)
    //     // {
    //     //     m_dims = dims;
    //     //     m_offset[0] = dims[0];
    //     //     m_offset[1] = dims[0] * dims[1];
    //     //     m_offset[2] = dims[0] * dims[1] * dims[2];
    //     //     m_voxelSize = calculateVoxelSize(dims, m_bbox);
    //     // }

    //     // void setBbox(McBox3f bbox)
    //     // {
    //     //     m_bbox = bbox;
    //     //     m_voxelSize = calculateVoxelSize(m_dims, bbox);
    //     // }

    //     void set(int64_t voxelId, unsigned char lutIndex)
    //     {
    //         auto triangles = MCLUT[lutIndex].tri_edges;

    //         auto found = m_map.find(voxelId);
    //         if (found == m_map.end())
    //         {
    //             m_map[voxelId] = { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 };
    //             found = m_map.find(voxelId);
    //         }

    //         for (int i = 0; i < 15; ++i)
    //         {
    //             if (triangles[i] == 255)
    //             {
    //                 found->second[i] = -1;
    //                 break;
    //             }
    //             found->second[i] = getGlobalEdgeIndex(triangles[i], voxelId, m_offset);
    //         }
    //     }

    //     std::array<unsigned char, 2> setMajority(unsigned char lutIndex, unsigned char background)
    //     {
    //         for (int i = 0; i < 8; ++i)
    //         {
    //             if (background & (1 << i))
    //             {
    //                 auto neighbors = VertexVertexNeighbor[i];
    //                 int color[3] = {
    //                     (lutIndex >> neighbors[0]) & ~(background >> neighbors[0]) & 1,
    //                     (lutIndex >> neighbors[1]) & ~(background >> neighbors[1]) & 1,
    //                     (lutIndex >> neighbors[2]) & ~(background >> neighbors[2]) & 1
    //                 };
    //                 int invalid[3] = {
    //                     (background >> neighbors[0]) & 1,
    //                     (background >> neighbors[1]) & 1,
    //                     (background >> neighbors[2]) & 1
    //                 };
    //                 int invalidNumber = invalid[0] + invalid[1] + invalid[2];
    //                 int trueColorNumber = color[0] + color[1] + color[2];
    //                 int falseColorNumber = 3 - invalidNumber - trueColorNumber;
    //                 if (trueColorNumber > 1)
    //                 {
    //                     lutIndex |= 1 << i;
    //                     background &= ~(1 << i);
    //                 }
    //                 else if (falseColorNumber > 1)
    //                 {
    //                     lutIndex &= ~(1 << i);
    //                     background &= ~(1 << i);
    //                 }
    //                 // do nothing otherwise, just keep as background
    //             }
    //         }
    //         return { lutIndex, background };
    //     }

    //     // clear triangles bordering on given background
    //     void set(int64_t voxelId, unsigned char lutIndex, unsigned char background, mutil::HashMapMappingView<SmallHashMap<int64_t, float>> distance_view)
    //     {
    //         auto changed = setMajority(lutIndex, background);
    //         lutIndex = changed[0];
    //         background = changed[1];

    //         auto triangles = MCLUT[lutIndex].tri_edges;
    //         bool disallowed[12] = { false, false, false, false, false, false, false, false, false, false, false, false };

    //         for (int i = 0; i < 8; ++i)
    //         {
    //             if (background & (1 << i))
    //             {
    //                 auto edgeNeighbors = VertexEdgeNeighbor[i];
    //                 disallowed[edgeNeighbors[0]] = true;
    //                 disallowed[edgeNeighbors[1]] = true;
    //                 disallowed[edgeNeighbors[2]] = true;
    //             }
    //         }

    //         auto found = m_map.find(voxelId);
    //         if (found == m_map.end())
    //         {
    //             m_map[voxelId] = { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 };
    //             found = m_map.find(voxelId);
    //         }

    //         int offset = 0;
    //         for (int i = 0; i < 5; ++i)
    //         {
    //             if (triangles[i * 3] == 255)
    //             {
    //                 found->second[i * 3 + offset] = -1;
    //                 break;
    //             }

    //             if (disallowed[triangles[i * 3]] || disallowed[triangles[i * 3 + 1]] || disallowed[triangles[i * 3 + 2]])
    //             {
    //                 offset -= 3;
    //                 continue;
    //             }

    //             for (int j = 0; j < 3; ++j)
    //             {
    //                 auto globalEdgeIndex = getGlobalEdgeIndex(triangles[i * 3 + j], voxelId, m_offset);
    //                 setMinDistance(voxelId, triangles[i * 3 + j], globalEdgeIndex, distance_view);
    //                 found->second[i * 3 + j + offset] = globalEdgeIndex;
    //             }
    //         }
    //     }

    //     void
    //     write(HxSurface* surface, std::size_t patchNumber) // patch = std::numeric_limits<size_t>::max() only possible when const expr are supported (not yet)
    //     {
    //         m_edgeIndexMapping.clear();
    //         auto patchSize = static_cast<std::size_t>(surface->patches.size());
    //         patchNumber = patchNumber < patchSize ? patchNumber : patchSize;
    //         int64_t edgeCounter = surface->points().size();
    //         int64_t triangleCounter = surface->triangles().size();
    //         HxSurface::Patch* patch = patchNumber == patchSize ? createNewPatch(surface) : surface->patches[patchNumber];

    //         for (auto entry : m_map)
    //         {
    //             // auto voxelId = entry.first;
    //             auto triangles = entry.second;
    //             for (int i = 0; i < 5; ++i)
    //             {
    //                 if (triangles[i * 3] == -1)
    //                 {
    //                     break;
    //                 }

    //                 // map points if we did not see them yet
    //                 for (int j = 0; j < 3; ++j)
    //                 {
    //                     auto edgeId = triangles[i * 3 + j];
    //                     auto found = m_edgeIndexMapping.find(edgeId);
    //                     if (found == m_edgeIndexMapping.end())
    //                     {
    //                         surface->points().push_back(getEdgePosition(edgeId, m_offset, m_voxelSize, m_bbox));
    //                         m_edgeIndexMapping.insert({ edgeId, edgeCounter++ });
    //                     }
    //                 }

    //                 HxSurface::Triangle triangle;
    //                 triangle.points[0] = m_edgeIndexMapping[triangles[i * 3 + 0]];
    //                 triangle.points[1] = m_edgeIndexMapping[triangles[i * 3 + 1]];
    //                 triangle.points[2] = m_edgeIndexMapping[triangles[i * 3 + 2]];
    //                 triangle.patch = patchNumber;
    //                 surface->triangles().push_back(triangle);
    //                 patch->triangles.push_back(triangleCounter++);
    //             }
    //         }
    //     }

    //     // Assume that given surface_data has the right size (encoding of nodes)
    //     void writeData(HxSurfaceScalarField* surface_data)
    //     {
    //         float* data = surface_data->dataPtr();
    //         for (auto pair : m_edgeIndexMapping)
    //         {
    //             data[pair.second] = m_edgeDistanceMapping.at(pair.first);
    //         }
    //     }

    //     float getDistanceData(McVec3f point)
    //     {
    //         int64_t id = getGlobalEdgeIndex(point, m_offset, m_voxelSize, m_bbox);
    //         return m_edgeDistanceMapping.at(id);
    //     }

    // protected:
    //     void
    //     setMinDistance(int64_t voxelId, unsigned char edge, int64_t globalEdgeIndex, mutil::HashMapMappingView<SmallHashMap<int64_t, float> > distance_view)
    //     {
    //         auto voxels = EdgeVertexNeighbor[edge];
    //         auto firstVoxel = getGlobalVoxelIndex(voxels[0], voxelId, m_offset);
    //         auto secondVoxel = getGlobalVoxelIndex(voxels[1], voxelId, m_offset);
    //         auto firstDistance = distance_view.get(firstVoxel);
    //         auto secondDistance = distance_view.get(secondVoxel);
    //         float minDistance = firstDistance < secondDistance ? firstDistance : secondDistance;
    //         auto found = m_edgeDistanceMapping.find(globalEdgeIndex);
    //         if (found == m_edgeDistanceMapping.end())
    //         {
    //             m_edgeDistanceMapping.insert({ globalEdgeIndex, minDistance });
    //         }
    //         else
    //         {
    //             found->second = found->second < minDistance ? found->second : minDistance;
    //         }
    //     }

    //     // map from voxelId to list of triangles (max 5) with global Edge Indices
    //     std::unordered_map<int64_t, std::array<int64_t, 15> > m_map;
    //     std::unordered_map<int64_t, float> m_edgeDistanceMapping;

    //     std::array<int64_t, 3> m_offset;
    //     McDim3l m_dims;
    //     McBox3f m_bbox;
    //     McVec3f m_voxelSize;

    //     // temporary memory for write method
    //     std::unordered_map<int64_t, int64_t> m_edgeIndexMapping;
    // };

    /**
     * @brief class to create a surface step-by-step using the marching cube algorithm.
     *
     * Note: One has to calculate the indices for the marching cube itself, as we do not assume a saved binary field.
     *
     */
    class SurfaceCreator
    {
    public:
        SurfaceCreator(Lattice lattice)
            : m_lattice(lattice)
            , m_edgeCounter(0)
            , m_triangleCounter(0)
            , m_surface()
            , m_edgeIndexMapping()
        {
        }

        // voxel is the lower left corner!
        void march(unsigned char lutIndex, VecSize voxel)
        {
            auto triangles = MCLUT[lutIndex].tri_edges;
            std::array<int64_t, 3> edgePos;

            for (int tri = 0; tri < 5; ++tri)
            {
                // test if we still have a triangle to look at
                if (triangles[tri * 3] == 255)
                {
                    break;
                }
                for (int i = 0; i < 3; ++i)
                {
                    auto edge = triangles[tri * 3 + i];
                    auto edgeIndex = getGlobalEdgeIndex(edge, voxel, m_lattice.dims());
                    // test if edge already exists
                    auto found = m_edgeIndexMapping.find(edgeIndex);
                    if (found == m_edgeIndexMapping.end())
                    {
                        // calculate worldPoint of edge
                        auto offset = EdgeWorldCoords[edge];
                        VecFloat worldPoint = VecFloat(
                            (static_cast<float>(voxel[0]) + offset[0]) * m_lattice.voxelsize()[0] + m_lattice.origin()[0],
                            (static_cast<float>(voxel[1]) + offset[1]) * m_lattice.voxelsize()[1] + m_lattice.origin()[1],
                            (static_cast<float>(voxel[2]) + offset[2]) * m_lattice.voxelsize()[2] + m_lattice.origin()[2]);
                        // m_surface->points().push_back(worldPoint);
                        m_surface.addPoint(worldPoint);
                        edgePos[i] = m_edgeCounter;
                        m_edgeIndexMapping[edgeIndex] = m_edgeCounter;
                        ++m_edgeCounter;
                    }
                    else
                    {
                        edgePos[i] = found->second;
                    }
                }
                // add new triangle with the 3 edgePos to surface
                // Surface::Triangle triangle;
                // triangle.points[0] = edgePos[0];
                // triangle.points[1] = edgePos[1];
                // triangle.points[2] = edgePos[2];
                // triangle.patch = 0;
                // m_surface->triangles().push_back(triangle);
                // auto patch = m_surface->patches[0];
                // patch->triangles.push_back(m_triangleCounter++);
                m_surface.addTriangle(edgePos[0],edgePos[1],edgePos[2]);
            }
        }

    protected:
        Lattice m_lattice;

        int64_t m_edgeCounter;
        int64_t m_triangleCounter;

        surface::Surface m_surface;
        std::unordered_map<int64_t, int64_t> m_edgeIndexMapping;
    };
} // namespace futil
